# GitHub Traffic API Laravel プロジェクト構成ドキュメント

## プロジェクト概要

このプロジェクトは、GitHubのトラフィックデータとフォロワー情報を収集・分析するLaravelベースのWebアプリケーションです。Dockerコンテナ環境で動作し、複数のGitHubリポジトリの訪問数やフォロワー情報を管理・可視化する機能を提供します。

## アーキテクチャ概要

### システム構成
- **バックエンド**: Laravel 12.0 (PHP 8.2.29)
- **フロントエンド**: Livewire 3.6 + TailwindCSS 4.0 + Vite 7.0
- **データベース**: MySQL 8.0.33
- **Webサーバー**: Nginx 1.18
- **コンテナ環境**: Docker Compose
- **開発環境**: VS Code Dev Container

### 主要機能
1. **GitHub訪問数集計**: 複数リポジトリの訪問数データを収集・管理
2. **フォロワー管理**: GitHubフォロワー情報の追跡・分析
3. **管理画面**: リポジトリ・ユーザー・データの管理
4. **認証システム**: ユーザー認証と権限管理
5. **データ可視化**: チャート・統計情報の表示

## ディレクトリ構造

```
GitHub-Traffic-API-Laravel/
├── _docs/                          # ドキュメント
│   ├── assets/                     # ドキュメント用アセット
│   └── *.md                        # 各種ドキュメント
├── .devcontainer/                  # VS Code Dev Container設定
│   ├── docker-compose.yml          # 開発環境用Docker Compose
│   ├── docker-compose.prod.yml     # 本番環境用Docker Compose
│   ├── docker-compose.import.yml   # データインポート用設定
│   ├── devcontainer.json           # VS Code設定
│   ├── php/                        # PHPコンテナ設定
│   │   ├── Dockerfile
│   │   ├── php-fpm.d/
│   │   ├── cron/
│   │   ├── supervisord/
│   │   └── shell/
│   ├── nginx/                      # Nginxコンテナ設定
│   │   ├── Dockerfile
│   │   └── default.conf
│   ├── mysql/                      # MySQLコンテナ設定
│   │   ├── Dockerfile
│   │   └── my.cnf
│   ├── node/                       # Node.jsコンテナ設定
│   │   └── Dockerfile
│   └── phpmyadmin/                 # phpMyAdmin設定
│       └── Dockerfile
├── deploy/                         # デプロイ設定
│   ├── docker/                     # Docker関連デプロイ設定
│   └── prod/                       # 本番環境設定
├── src/                           # Laravelアプリケーション
│   ├── app/                       # アプリケーションロジック
│   │   ├── Console/               # Artisanコマンド
│   │   ├── Helpers/               # ヘルパー関数
│   │   ├── Http/                  # HTTP関連
│   │   │   └── Controllers/       # コントローラー
│   │   ├── Livewire/              # Livewireコンポーネント
│   │   ├── Models/                # Eloquentモデル
│   │   └── Providers/             # サービスプロバイダー
│   ├── database/                  # データベース関連
│   │   ├── migrations/            # マイグレーションファイル
│   │   ├── factories/             # ファクトリー
│   │   ├── seeders/               # シーダー
│   │   └── database.sqlite        # SQLiteファイル（開発用）
│   ├── public/                    # 公開ディレクトリ
│   ├── resources/                 # リソースファイル
│   │   ├── css/                   # CSSファイル
│   │   ├── js/                    # JavaScriptファイル
│   │   └── views/                 # Bladeテンプレート
│   │       ├── admin/             # 管理画面テンプレート
│   │       ├── auth/              # 認証テンプレート
│   │       ├── github/            # GitHub関連テンプレート
│   │       ├── layouts/           # レイアウトテンプレート
│   │       └── livewire/          # Livewireテンプレート
│   ├── routes/                    # ルーティング
│   │   ├── web.php                # Webルート
│   │   └── console.php            # コンソールルート
│   ├── storage/                   # ストレージ
│   ├── tests/                     # テストファイル
│   ├── composer.json              # PHP依存関係
│   ├── package.json               # Node.js依存関係
│   ├── vite.config.js             # Vite設定
│   └── artisan                    # Laravel CLI
├── README.md                      # プロジェクト説明
└── LICENSE                        # ライセンス
```

## Docker環境構成

### サービス構成

#### 1. app (PHP-FPM)
- **コンテナ名**: `github-traffic-api-backend`
- **ベースイメージ**: `php:8.2.29-fpm`
- **機能**:
  - Laravelアプリケーション実行
  - Composer依存関係管理
  - Xdebug有効
  - Cronジョブ実行
  - Supervisorによるプロセス管理

#### 2. web (Nginx)
- **コンテナ名**: `github-traffic-api-web`
- **ベースイメージ**: `nginx:1.18-alpine`
- **機能**:
  - 静的ファイル配信
  - PHP-FPMへのプロキシ
  - ポート: 80

#### 3. db (MySQL)
- **コンテナ名**: `github-traffic-api-db`
- **ベースイメージ**: `mysql:8.0.33-debian`
- **機能**:
  - データベースサーバー
  - ポート: 3333 (ホスト) → 3306 (コンテナ)

#### 4. node (Node.js)
- **コンテナ名**: `github-traffic-api-node`
- **ベースイメージ**: `node:20.19-alpine`
- **機能**:
  - フロントエンド資産のビルド
  - Vite開発サーバー
  - ポート: 5174 (ホスト) → 5173 (コンテナ)

#### 5. phpmyadmin
- **コンテナ名**: `github-traffic-api-phpmyadmin`
- **機能**:
  - データベース管理UI
  - ポート: 8091

### ネットワーク構成
- **共有ネットワーク**: `nginx-proxy-manager-network`
- 外部ネットワークに接続してリバースプロキシ経由でアクセス

### ボリューム構成
- `db-store`: MySQLデータ永続化
- `php-fpm-socket`: PHP-FPMソケット共有
- `app-storage`: 本番環境用アプリケーションストレージ

## データベース設計

### テーブル構成

#### 1. users
- ユーザー管理テーブル
- 認証・権限管理
- 管理者フラグ (`is_admin`)
- アクティブ状態フラグ (`is_active`)

#### 2. github_repositories
- GitHubリポジトリ管理
- 複数リポジトリ対応
- リポジトリ専用トークン管理
- 有効/無効状態管理

#### 3. github_views
- GitHub訪問数データ
- プロジェクト別・日付別集計
- 訪問数 (`count`) とユニーク訪問数 (`uniques`)

#### 4. github_followers
- フォロワー数統計
- 日付別フォロワー数追跡
- フォロー中数・パブリックリポジトリ数も記録

#### 5. github_follower_details
- フォロワー詳細情報
- アンフォロー日時追跡 (`unfollowed_at`)

### インデックス設計
- 複合ユニーク制約による重複防止
- 日付・ステータス・オーナー名でのインデックス最適化

## アプリケーション構成

### Laravel設定
- **バージョン**: 12.0
- **PHP**: 8.2.29
- **主要パッケージ**:
  - Livewire 3.6 (リアクティブUI)
  - Laravel Tinker 2.10.1
  - Laravel Pail 1.2.2 (ログ監視)
  - Laravel Pint 1.13 (コード整形)

### フロントエンド設定
- **ビルドツール**: Vite 7.0.4
- **CSSフレームワーク**: TailwindCSS 4.0
- **JavaScript**: Axios 1.11.0
- **開発ツール**: Concurrently 9.0.1

### ルーティング構成

#### 認証ルート
- `/login` - ログイン
- `/logout` - ログアウト

#### 一般ルート
- `/` - ホームページ

#### GitHub関連ルート (認証必須)
- `/github/followers` - フォロワー一覧
- `/github/follower-details` - フォロワー詳細
- `/github/api/followers/*` - API エンドポイント

#### 管理画面ルート (認証必須)
- `/admin/` - ダッシュボード
- `/admin/repositories` - リポジトリ管理
- `/admin/followers` - フォロワー管理
- `/admin/users` - ユーザー管理 (管理者のみ)

## 開発環境設定

### VS Code Dev Container
- **リモートユーザー**: `h-nishihara`
- **ワークスペース**: `/workspace`
- **主要拡張機能**:
  - PHP Debug (Xdebug)
  - PHP Intelephense
  - Laravel Extension Pack
  - PHP CS Fixer
  - PHPStan

### 開発ワークフロー
1. `composer dev` - 開発サーバー起動
2. 並行実行:
   - Laravel開発サーバー
   - キューリスナー
   - ログ監視 (Pail)
   - Vite開発サーバー

## 本番環境設定

### 本番用Docker Compose
- 開発用サービス無効化 (node, phpmyadmin)
- ヘルスチェック設定
- 自動再起動設定
- ストレージボリューム分離

### セキュリティ設定
- デバッグモード無効
- 本番環境変数
- 適切な権限設定

## 運用・監視

### ログ管理
- Laravel Pailによるリアルタイムログ監視
- 日毎ログローテーション
- タイムスタンプ付与

### バックアップ
- MySQLデータベースバックアップ
- mysqldumpコマンド使用
- 定期実行設定

### 権限管理
- SGIDビット設定によるグループ権限
- Laravelログファイルの適切な権限設定

## トラブルシューティング

### よくある問題
1. **Dockerコンテナネットワーク問題**
   - 外部ネットワーク接続設定
   - ポート競合解決

2. **NPM設定問題**
   - パッケージインストール失敗
   - 依存関係解決

3. **権限問題**
   - ファイル・ディレクトリ権限
   - グループ権限設定

4. **データベース接続問題**
   - 接続設定確認
   - マイグレーション実行

## 今後の拡張予定

### 機能拡張
- より詳細な分析機能
- レポート生成機能
- API エンドポイント拡張

### 技術的改善
- パフォーマンス最適化
- セキュリティ強化
- 監視機能拡充

---

このドキュメントは、AIがプロジェクトの全体像を迅速に把握し、適切な支援を提供できるよう設計されています。各セクションは独立して参照可能で、必要に応じて詳細な調査を行うための指針として機能します。
